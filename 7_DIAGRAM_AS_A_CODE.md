# 7. Diagram as a Code

## Високорівнева архітектура системи "Плай"

### Діаграма компонентів системи

```mermaid
graph TB
    %% Клієнтські компоненти
    subgraph "Клієнтський рівень"
        A[Веб-клієнт<br/>SPA додаток]
        B[Адмін панель<br/>Інтерфейс управління]
    end
    
    %% Основний бекенд - МОНОЛІТ
    subgraph "Рівень додатку"
        C[Бекенд API<br/>Монолітний додаток]
        
        subgraph "Модулі додатку"
            D[Модуль автентифікації]
            E[Модуль каталогу]
            F[Модуль замовлень]
            G[Модуль платежів]
        end
    end
    
    %% Зовнішні сервіси
    subgraph "Зовнішні сервіси"
        H[Платіжні шлюзи<br/>LiqPay, Stripe]
        I[Логістичні API<br/>Нова Пошта]
        J[Email сервіс]
    end
    
    %% Єдина база даних
    subgraph "Рівень даних"
        K[(Основна база даних<br/>PostgreSQL)]
    end
    
    %% З'єднання
    A --> C
    B --> C
    C --> D
    C --> E
    C --> F
    C --> G
    
    D --> K
    E --> K
    F --> K
    G --> K
    
    G --> H
    F --> I
    C --> J
```


### Діаграма потоків даних для процесу замовлення


```mermaid
sequenceDiagram
    participant К as Користувач
    participant В as Веб-клієнт
    participant API as Бекенд API
    participant БД as База даних
    participant ПШ as Платіжний шлюз
    participant Л as Логістичний API
    
    К->>В: Додає книгу в кошик
    В->>API: Оновлення кошика
    API->>БД: Збереження кошика
    БД-->>API: Підтвердження
    API-->>В: Успіх
    В-->>К: Кошик оновлено
    
    К->>В: Оформлення замовлення
    В->>API: Створення замовлення
    API->>БД: Бронювання товару
    API->>Л: Розрахунок доставки
    Л-->>API: Вартість доставки
    API-->>В: Дані для оплати
    В-->>К: Форма оплати
    
    К->>В: Оплата
    В->>API: Ініціація оплати
    API->>ПШ: Запит на оплату
    ПШ-->>API: Результат оплати
    API->>БД: Підтвердження замовлення
    API-->>В: Успішна оплата
    В-->>К: Замовлення підтверджено
```



## Опис архітектури
Система "Плай" реалізована за монолітною архітектурою з чітким розділенням модулів, що відповідає опису з пунктів 1-6 документації.

## Клієнтський рівень
- Веб-клієнт: Single Page Application для кінцевих користувачів
- Адмін панель: Інтерфейс адміністратора для управління контентом

## Рівень додатку
- Бекенд API: Єдиний монолітний додаток з модульною структурою:

    - Модуль автентифікації: управління користувачами та аутентифікація
    - Модуль каталогу: каталог книг, пошук, фільтрація
    - Модуль замовлень: кошик, замовлення, управління станом
    - Модуль платежів: обробка платежів, інтеграція з платіжними шлюзами

## Рівень даних
- Єдина база даних: PostgreSQL для всіх даних системи

## Зовнішні сервіси
- Інтеграція з платіжними системами (LiqPay, Stripe)
- Інтеграція з логістичними операторами (Нова Пошта)
- Сервіс відправки email-сповіщень


## Технологічний стек
- Frontend: Angular SPA
- Backend: ASP.NET Core монолітний API
- Database: PostgreSQL
- Кешування: Redis (опціонально)
- Хмарна інфраструктура: AWS/Azure/Google Cloud